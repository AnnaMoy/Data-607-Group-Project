---
title: "Data 607 Final Project"
author: "Natalie Kalukeerthie, Anna Moy, Bishoy Sokkar"

output: 
  prettydoc::html_pretty:
    theme: architect
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

During the year of 2020, the world went into lock down, many people were forced to stay home, thus having the time and space to consume more media than ever before.

We could see movies being a popular source of entertainment during both during the peak of lock down (Spring/Summer 2020) where people watched many movies in their howes and once restrictions were eased and people were allowed to finally congregate in public spaces again.

As the movie and entertainment industry have a large impact on today’s pop culture, we’re intrigued to see how successful certain movies were over the years, especially in 2020. We will also be delving into the gross income of a variety of movies in order to find which movie has the highest gross income. 

We will also dig a bit deeper to see what movies were most successful via different categories (all time, by a specific year, genre etc).  

Our datasets will be coming from Kaggle: [Movie Industry](https://www.kaggle.com/datasets/danielgrijalvas/movies) and through web scraping on [Box Office Mojo](https://www.boxofficemojo.com/year/2020/). 

Our team used slack, discord and github in order to collaborate effectively.

# Data Collection
``` {r load library, message = FALSE}
#load library
library(tidyverse)
library(rvest)
library(lubridate)
```

```{r read-csv-file, message = FALSE}
#read csv file from kaggle
movie <- read_csv("https://raw.githubusercontent.com/AnnaMoy/Data-607-Project/main/movies.csv")
movie
```

```{r scrape-movie}
# Webscraping
# link to the website
url <- "https://www.boxofficemojo.com/year/2020/"

# read url link 
webpage <- read_html(url)

# pull in gross data from 2020
gross_2020 <- html_nodes(webpage, ".mojo-field-type-date , .mojo-estimatable , .mojo-cell-wide") %>%
  html_text()

# put into dataframe for total gross and average
df <- data.frame(gross = gross_2020)

head(df,20)
``` 

We decided to get out send dataset through web-scraping. By using the function html_nodes(), we pulled in gross movie data for 2020 from https://www.boxofficemojo.com/year/2020/ 

# Data Transformation and Cleaning

The originally scraped data is not in a useable format, so we must transform it into wide data so that we will have a unique value in the first column (date)

```{r data-transformation-webscrape}

# split up the data into their own columns
df <- df %>%
  mutate(ind = rep(c("title", "gross_data", "total_gross","date"),length.out = n())) %>%
  group_by(ind) %>%
  mutate(id = row_number()) %>%
  spread(ind, gross) %>%
  select(-id)

#remove line 1
moviedf <- df[-1,]
moviedf

```

```{r data-transformation}
# get the release date in kaggle movie dataset
movie<- movie %>% separate_wider_delim(released, delim =" (", names= c("date","location"))

#convert release date into date format
movie$date <- mdy(movie$date)

#add in year and quarter
movie<-movie %>%
  mutate(qtr= quarter(date,with_year = T))

movie
```

```{r join-scrap_data-kaggle_data}
#joining the data for kaggle movie and scraped data
movie2020 <-inner_join(movie, moviedf, by=c("name" = "title"))
movie2020
```

```{r making gross numeric}
#creating a subset
movie2020_numeric <- movie2020

#converting gross income into a numeric value for analysis
movie2020_numeric$total_gross_numeric <- movie2020_numeric$total_gross
movie2020_numeric$total_gross_numeric <- as.character(gsub("\\$", "", movie2020_numeric$total_gross_numeric))
movie2020_numeric$total_gross_numeric <- as.numeric(gsub(",", "", movie2020_numeric$total_gross_numeric))

#displaying highest gross incomes first
movie2020_numeric <- movie2020_numeric[order(movie2020_numeric$total_gross_numeric, decreasing = TRUE),]
movie2020_numeric
```
# Analysis
# Statistical Analysis
Research Question: Is there a difference between action and horror genre and their average gross?

Null Hypothesis: H0: mean1 = mean2
Alternative Hypothesis: HA: mean1 != mean2

Reject the Null Hypothesis since p-value is less than .05.

```{r statistical-analysis}
# mean, sd and n for action and horror genre
stat_genre <- movie %>%
  filter(genre == "Action" | genre == "Horror") %>%
  group_by(genre) %>%
  summarize(mean = mean(gross, na.rm=T), sd = sd(gross, na.rm = T), n = n())
stat_genre

# genre for action and horror genre
genre_act_hor<- movie %>%
  filter(genre == "Action" | genre == "Horror") %>%
  filter(!is.na(gross))
genre_act_hor

#T Test 
t.test(gross ~ genre, data = genre_act_hor)

#boxplot for horror and action genre
ggplot(genre_act_hor, aes(genre, gross)) +
  geom_boxplot() 
```








# One feature that we did not cover in class (Data Visualization) 

Our team wanted to visualize the consumption of movies across the world, using ggolot along with the packages loaded below to create a map showing total movie revenue by country. To create a map we used dplyr to filter the relevant columns, including the country. We then grouped by country summing the revenue from each movie. We then used the Iso package to find a common code for each country to be easily identfiable. We then used the sf package to load a map and plot the data on. 

```{r}
library(sf)
library(ggrepel)
library(countrycode)
library(rnaturalearth)
```



```{r}

map_data <- movie %>%
  select(year, country, budget, gross) %>%
  mutate( profit = gross-budget) %>%
  na.omit(gross) %>%
  filter(year <= 2010) %>%
  group_by(country) %>%
  summarise(total_income = sum(profit))


#Add ISO which is a 3 letters code for each country  for Join function to work

data_with_iso <- map_data %>%
  mutate(Iso3 = countrycode::countrycode(
    sourcevar = country,
    origin = "country.name",
    destination = "iso3c"))
#

world <- ne_countries(scale = "small", returnclass = "sf") 

countries_movie_consumption <- world %>%
  select(geometry, name, iso_a3) %>%
  left_join(data_with_iso, by = c("iso_a3" = "Iso3"))


world %>% 
  st_transform(crs = "+proj=robin") %>%
  ggplot() +
  geom_sf(color = "darkgray") +
  geom_sf(data = countries_movie_consumption, aes(fill = total_income)) +
  theme_minimal() +
   labs(
    title = "World Movie Revenue by Country from 2010 - 2020",
    subtitle = "Total Gross Income from Movies in million",
    fill = "Total Gross Income (USD)"
  )


```
From the plot above we can see that the USA is a lead in movie revenue. The USA movie industry not only generates substantial revenue but also serves as a key ambassador of American culture and values worldwide.


```{r}

map_data_2020 <- movie %>%
  select(year, country, budget, gross) %>%
  mutate( profit = gross-budget) %>%
  na.omit(gross) %>%
  filter(year == 2020) %>%
  group_by(country) %>%
  summarise(total_gross_income = sum(gross))

data_with_iso <- map_data_2020 %>%
  mutate(Iso3 = countrycode::countrycode(
    sourcevar = country,
    origin = "country.name",
    destination = "iso3c"))


world_2020 <- ne_countries(scale = "small", returnclass = "sf") 

countries_movie_consumption_2020 <- world_2020 %>%
  select(geometry, name, iso_a3) %>%
  left_join(data_with_iso, by = c("iso_a3" = "Iso3"))


world_2020 %>% 
  st_transform(crs = "+proj=robin") %>%
  ggplot() +
  geom_sf(color = "darkgray") +
  geom_sf(data = countries_movie_consumption_2020, aes(fill = total_gross_income)) +
  theme_minimal() +
   labs(
    title = "World Movie Revenue by Country from 2020",
    subtitle = "Total Gross Income from Movies in million",
    fill = "Total Gross Income (USD)"
  )

```

We can see from the plot above that in 2020 the movie revenue  for three countries: USA, Canada and China. 


# Conclusion (include challenges faced)
